# 用户故事 1-4：找回密码

## 故事描述

作为一名忘记密码的用户，我希望能够通过找回密码功能，重置我的登录密码，继续访问系统。

## 验收标准

- 用户可以通过用户名发起找回密码请求
- 系统生成验证码供用户验证
- 用户可以通过验证码重置密码
- 找回密码过程基本安全

## 业务价值

- 降低因忘记密码导致的用户流失
- 提供基本的密码重置功能

---

## 技术实现建议（Tech Lead）

- 前端：找回密码表单，验证码输入，密码重置表单
- 后端：生成验证码，验证用户身份，更新密码
- 安全：基本的验证码验证

## 技术难点

- 验证码的生成与验证
- 用户身份验证

## 测试建议

- 单元测试：验证码生成与校验
- 集成测试：找回密码流程基本功能测试

---

## 详细实现步骤

### 前端实现步骤

1. **找回密码页面**
   - 创建 `app/auth/forgot-password/page.tsx`
   - 设计简洁的找回密码表单
   - 添加用户名输入字段

2. **表单验证**
   - 使用 React Hook Form 进行表单验证
   - 验证用户名格式
   - 实现基本验证反馈

3. **提交处理**
   - 创建 `lib/auth.ts` 中的找回密码 API 调用
   - 处理提交状态和错误信息
   - 显示基本的成功/失败提示

4. **验证码输入页面**
   - 创建 `app/auth/verify-code/page.tsx`
   - 通过 URL 参数获取用户标识
   - 实现验证码输入表单

5. **重置密码页面**
   - 创建 `app/auth/reset-password/page.tsx`
   - 通过验证码验证用户身份
   - 实现新密码和确认密码表单

6. **密码重置表单**
   - 验证新密码基本要求
   - 确认密码一致性检查

7. **用户体验优化**
   - 添加加载状态指示器
   - 实现基本的错误提示
   - 成功重置后的跳转逻辑

### 后端实现步骤

1. **找回密码 API**
   - 创建 `app/api/auth/forgot-password/route.ts`
   - 验证用户名是否存在
   - 生成验证码

2. **验证码生成**
   - 生成简单的数字验证码
   - 设置验证码过期时间（30分钟）
   - 将验证码与用户关联存储

3. **验证码验证 API**
   - 创建 `app/api/auth/verify-code/route.ts`
   - 验证验证码的有效性
   - 返回验证结果

4. **重置密码 API**
   - 创建 `app/api/auth/reset-password/route.ts`
   - 验证验证码的有效性
   - 更新用户密码

### 数据库设计（Prisma Schema）

1. **密码重置表**
   ```prisma
   model PasswordReset {
     id        String   @id @default(cuid())
     userId    String
     code      String   @unique
     expiresAt DateTime
     usedAt    DateTime?
     createdAt DateTime @default(now())
     
     @@map("password_resets")
   }
   ```

### 基本测试步骤

1. **API 测试**
   - 测试找回密码请求
   - 测试验证码验证流程
   - 测试验证码过期处理

2. **验证码测试**
   - 测试验证码生成功能
   - 测试验证码验证逻辑
   - 测试验证码过期机制

